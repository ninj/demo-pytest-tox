# demo-pytest-tox

- Based on https://joecmarshall.com/posts/python-app-seed/
    - this demo will concentrate on building and producing a dist for a python **app**
- For pip-tools: https://github.com/jazzband/pip-tools
- For using pyenv with tox to supply python
  versions: https://operatingops.com/2020/10/24/tox-testing-multiple-python-versions-with-pyenv/
- For maintaining pyenv with brew python
  versions: https://stackoverflow.com/questions/30499795/how-can-i-make-homebrews-python-and-pyenv-live-together

## Structure

- `./` - created by IntelliJ New Project
- `src/` - main source
- `tests/` - tests for pytest
- `venv/` - created by `bootstrap.sh` if VIRTUAL_ENV not present.
- `.python-version` - pyenv config (should match what tox uses)
- `bootstrap.sh` - creates / updates `venv`
- `build.sh` - runs build.
- `dev-requirements.in` - input for `pip-compile`
- `dev-requirements.txt` - output from `pip-compile`
- `editable-requirements.in` - input for `pip-compile`
- `editable-requirements.txt` - output from `pip-compile` (ignored by git, automatically created by `bootstrap.sh`)
- `invoke.yaml` - pyinvoke configuration
- `pyproject.toml` - generated by `flit init`
- `requirements.in` - input for `pip-compile`
- `requirements.txt` - output from `pip-compile`
- `tasks.py` - task definitions for pyinvoke.
- `tox.ini` - `tox` configuration

## Features

- dependency resolution with `pip-compile`
- code formatting with `isort` and `black`
- linting with `pylint`
- tests with `pytest`

Note that Black uses a line length of 88 characters, so you might need to change your IDE settings to match.

For Intellij, `Editor > Code Style > Python` > set `Hard Wrap At` and `Visual Guides` to `88`. 


## Usage

- to set up developer environment, run `./bootstrap.sh` to:
    - create `venv`
    - install dev-requirements
    - install current project as editable
    - can be run multiple times to update `venv`
- to build project, run `./build.sh`
    - also calls `bootstrap.sh`, so easily used in something like restabuild.
    - runs QA checks, so badly formatted code will fail build.
- other tasks can be run via `invoke` (which is installed along with dev requirements.)

### `invoke`

- list tasks with `inv -l`
- set up completion with `source <(inv print-completion-script bash)` (replace `bash` with `zsh` as appropriate)
- `inv requirements-update` will call `pip-compile` to:
    - generate `requirements.txt` from `requirements.in`
    - generate `dev-requirements.txt` from `dev-requirements.in`
- `inv requirements-install` will install requirements into `venv` (with `pip-sync`)
- `inv code-check` will run code checks
- `inv code-format` will reformat code
- `inv test` will run tests via `tox` for multiple python versions.

Note that `pip` keeps re-installing editable modules - think that has to do with the way `pip` handles editable modules.
